<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>2026 è»Šæµé€€å ´ä½œæ¥­ç³»çµ±</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* =========================================
       1. Design Tokens & Colors (Mobile First)
       ========================================= */
    :root {
      /* Brand Colors */
      --c-brand: #1f6fe5;       /* ä¸»è‰²è— (Primary) */
      --c-brand-dark: #1e40af;  /* æ·±è— */
     
      /* Functional Colors */
      --c-success: #22c55e;     /* ç¶ è‰² (ä¿®æ”¹/å®Œæˆ) */
      --c-danger: #ef4444;      /* ç´…è‰² (åˆªé™¤/æœªå®Œæˆ) */
      --c-neutral: #64748b;     /* ç°è‰² (ç•¥é/æ¬¡è¦) */
      --c-dark: #334155;        /* æ·±ç° (ç³»çµ±æŒ‰éˆ•) */
     
      /* Backgrounds */
      --bg-success-light: #ecfdf5; /* å®Œæˆé …ç›®çš„æ·¡ç¶ åº• */
      --border-success: #10b981;   /* å®Œæˆé …ç›®çš„ç¶ æ¡† */
      --text-success: #047857;     /* å®Œæˆé …ç›®çš„ç¶ å­— */

      /* UI Bases */
      --bg-body: #e5e7eb;
      --bg-app: #f8fafc;
      --bg-surface: #ffffff;
      --border: #e2e8f0;
     
      /* Text Colors */
      --text-main: #0f172a; /* æ·±é»‘ (ä¸»è¦å…§å®¹) */
      --text-sub: #64748b;  /* æ·±ç° (æ¬¡è¦å…§å®¹) */

      /* Metrics */
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-pill: 50px;
      --app-max-width: 800px; /* æ‰‹æ©Ÿç‰ˆæœ€å¤§å¯¬åº¦é™åˆ¶ */
     
      /* Layers */
      --z-bottom: 1100;
      --z-overlay: 1000;
      --z-header: 500;
    }

    body { 
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
      background: var(--bg-body); color: var(--text-main); 
      padding-bottom: 0; -webkit-tap-highlight-color: transparent;
    }

    /* App Shell */
    #appView {
      max-width: var(--app-max-width); margin: 0 auto;
      background-color: var(--bg-app); min-height: 100vh;
      box-shadow: 0 0 30px rgba(0,0,0,0.1); padding-bottom: 80px; 
    }

    .container { padding: 12px; } /* Slightly tighter padding for mobile */

    /* =========================================
       2. Header (Sticky & Consolidated)
       ========================================= */
    .app-header {
      background: var(--bg-surface); 
      position: sticky; top: 0; z-index: var(--z-header);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      padding-bottom: 8px; /* Give some space for the bottom row */
    }

    /* Top Row: Title | Clock | Refresh | Logout */
    .header-main {
      padding: 12px 16px 8px 16px;
      display: grid;
      /* Left (Title) | Center (Time) | Right (Controls) */
      grid-template-columns: 1fr auto 1fr;
      align-items: center; gap: 8px;
    }

    .app-title { 
      font-size: 1.1rem; font-weight: 800; color: var(--c-brand); 
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    .header-clock { 
      font-family: monospace; 
      font-size: 1.1rem; font-weight: 800; 
      color: var(--text-main); white-space: nowrap; 
    }

    .header-right { display: flex; justify-content: flex-end; align-items: center; gap: 8px; }

    /* Refresh Buttons */
    .refresh-ctrl { display: flex; background: #f1f5f9; padding: 2px; border-radius: var(--radius-pill); }
    .refresh-btn { 
      border: none; background: transparent; padding: 4px 8px; 
      font-size: 11px; font-weight: 600; color: var(--text-sub); 
      border-radius: var(--radius-pill); cursor: pointer; transition: 0.2s;
    }
    .refresh-btn.active { background: #fff; color: var(--c-brand); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

    /* Logout Button */
    .btn-logout {
      background: var(--c-dark); color: #fff; border: none; padding: 6px 12px;
      border-radius: 6px; font-size: 12px; font-weight: 700; cursor: pointer;
    }

    /* Level 1 Navigation (Big Pills) - æ•´é«”æƒ…å ± / ç™»éŒ„èˆ‡ä¿®æ”¹ */
    .nav-tabs-wrapper {
      display: flex; gap: 10px; padding: 0 16px 8px 16px; justify-content: center;
    }
    .nav-tab {
      flex: 1; padding: 8px 0; border: none; border-radius: var(--radius-pill);
      font-size: 0.95rem; font-weight: 800; cursor: pointer; transition: 0.2s;
      text-align: center; white-space: nowrap;
      background: #fff; color: var(--c-brand); border: 1px solid var(--c-brand);
    }
    .nav-tab.active { background: var(--c-brand); color: #fff; border-color: var(--c-brand); box-shadow: 0 2px 6px rgba(31, 111, 229, 0.3); }

    /* Level 2 Navigation (Scrollable Pills) - å…¨éƒ¨æƒ…å ± / å„è·¯ç·šæŒ‰éˆ• */
    .nav-scroll-container {
      display: flex; gap: 8px; overflow-x: auto; 
      padding: 4px 16px 8px 16px;
      -webkit-overflow-scrolling: touch; /* iOS Scroll Momentum */
      background: var(--bg-surface);
      /* Hide Scrollbar visually but keep functionality */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none;  /* IE 10+ */
    }
    .nav-scroll-container::-webkit-scrollbar { 
      display: none; /* Chrome/Safari/Webkit */
    }

    .filter-btn {
      padding: 6px 14px; border-radius: var(--radius-pill); border: 1px solid transparent;
      font-size: 0.85rem; font-weight: 700; white-space: nowrap; cursor: pointer;
      background: #fff; color: var(--text-sub); border-color: var(--border);
      transition: 0.2s; flex-shrink: 0; /* Prevent shrinking */
    }
   
    /* =========================================
       3. Tab 1: Overall Info (çœ‹æ¿)
       ========================================= */
    .dash-section { margin-bottom: 24px; animation: fadeIn 0.3s; }
    .dash-title { 
      font-size: 1.1rem; font-weight: 800; margin-bottom: 12px; 
      padding-left: 10px; border-left: 5px solid var(--c-brand); 
      display: flex; justify-content: space-between; align-items: center; color: var(--text-main);
    }
   
    .stat-card {
      background: var(--bg-surface); border-radius: var(--radius-lg);
      padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      border: 1px solid var(--border);
    }
    .step-header { font-size: 1rem; font-weight: 700; margin-bottom: 10px; color: var(--text-main); }
    .stat-row { display: flex; gap: 12px; }
    .stat-box {
      flex: 1; text-align: center; background: #f8fafc;
      border-radius: var(--radius-md); padding: 12px 8px; cursor: pointer;
      border: 1px solid transparent;
    }
    .stat-box:active { background: #e2e8f0; }
    .stat-num { font-size: 2rem; font-weight: 900; line-height: 1.1; } /* Big Number */
    .stat-lbl { font-size: 0.8rem; color: var(--text-sub); margin-top: 4px; font-weight: 600; }
    .num-done { color: var(--c-brand); }
    .num-todo { color: var(--c-danger); }

    /* Location Cards (Peeking & Grid) */
    .loc-container {
      display: flex; gap: 10px; padding-bottom: 8px; 
      overflow-x: auto; scroll-snap-type: x mandatory;
    }
    .loc-card {
      /* Mobile: 42% width ensures ~2.2 cards visible (Peeking effect) */
      flex: 0 0 42%; min-width: 120px; 
      background: var(--bg-surface); border: 1px solid var(--border);
      border-radius: var(--radius-md); padding: 12px; text-align: center; 
      scroll-snap-align: start; cursor: pointer;
      transition: 0.2s;
    }
    .loc-card:active { transform: scale(0.98); background: #f1f5f9; }
    @media (min-width: 768px) {
      .loc-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; overflow-x: visible; }
      .loc-card { flex: unset; min-width: auto; }
    }
    .loc-name { font-size: 0.85rem; font-weight: 600; color: var(--text-sub); margin-bottom: 4px; }
    .loc-val { font-size: 1.5rem; font-weight: 800; color: var(--c-brand); }

    /* Summary Table */
    .summary-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 8px; }
    .summary-table th, .summary-table td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: left; }
    .summary-table th { color: var(--text-sub); font-weight: 600; font-size: 0.85rem; }
    .summary-table tr:last-child td { border-bottom: none; }
    .summary-table td { color: var(--text-main); font-weight: 500; }

    /* Responsive Table Logic - NOW: Area first, then Car */
    .col-desktop-car { display: none; }
    .mobile-area-tag { display: block; font-size: 1rem; font-weight: 800; margin-bottom: 2px; }
    .mobile-car-tag { display: block; font-size: 0.85rem; color: var(--text-sub); font-weight: 600; }

    @media (min-width: 768px) {
        .col-desktop-car { display: table-cell; }
        .mobile-area-tag, .mobile-car-tag { display: none; }
    }

    /* =========================================
       4. Tab 2: Operation List (Grid Layout)
       ========================================= */
    .op-action-row {
        display: flex; justify-content: center; margin-bottom: 12px;
    }
    .btn-add { 
      padding: 10px 24px; background: #fff; border: 1px solid var(--c-brand); 
      color: var(--c-brand); border-radius: var(--radius-pill); font-weight: 700; cursor: pointer; white-space: nowrap;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05); width: 100%; text-align: center;
    }
    .btn-add:active { background: #f0f9ff; }

    /* List Card - Updated for Fixed Layout */
    .veh-card {
      background: var(--bg-surface); border-radius: var(--radius-md);
      padding: 12px 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      cursor: pointer; transition: 0.2s; border: 1px solid transparent;
     
      /* Grid: [Left 55% Fixed] | [Status Auto] | [Btn 40px] */
      display: grid;
      grid-template-columns: 55% 1fr 40px; 
      align-items: center; gap: 8px;
      min-height: 70px;
    }
    .veh-card:active { transform: scale(0.98); background-color: #f8fafc; }

    /* Left Column Stack (Vehicle Info) - Truncate with Ellipsis */
    .veh-col-left { 
      display: flex; flex-direction: column; gap: 2px; 
      overflow: hidden; /* Essential for child ellipsis */
      min-width: 0;     /* Flexbox nested text overflow fix */
    }
    .txt-car { 
      font-size: 1.15rem; font-weight: 800; color: #000; line-height: 1.2; 
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .txt-area { 
      font-size: 13px; /* Smaller font */
      font-weight: 700; color: var(--text-sub); line-height: 1.2; 
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
   
    /* Middle Column Stack (Status) */
    .veh-col-mid { display: flex; flex-direction: column; gap: 2px; }
    .status-row { font-size: 0.95rem; font-weight: 700; color: var(--c-brand); line-height: 1.3; }
    .status-sep { border-top: 1px dashed #cbd5e1; margin: 4px 0; width: 100%; opacity: 0.5; }
    .status-pending { color: var(--c-neutral); font-weight: 500; }
    /* Dynamic status style */
    .status-dynamic { font-size: 0.9rem; font-weight: 600; color: var(--c-brand-dark); }

    /* Expand Button (+) */
    .btn-expand {
      width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
      background: #eff6ff; color: var(--c-brand); border-radius: 8px; 
      font-weight: 800; font-size: 20px; border: 1px solid #dbeafe;
    }

    /* Completed State */
    .veh-card.completed {
      background-color: var(--bg-success-light);
      border-color: var(--border-success);
    }
    .veh-card.completed .status-row { color: var(--text-success); }
    .veh-card.completed .btn-expand { background: var(--border-success); color: #fff; border-color: var(--border-success); }

    .filter-bar {
      background: #eff6ff; color: var(--c-brand); padding: 8px 12px;
      border-radius: 8px; margin-bottom: 12px; font-size: 0.9rem; display: flex;
      justify-content: space-between; align-items: center; border: 1px solid #bfdbfe;
    }
    .filter-clear { text-decoration: underline; cursor: pointer; font-weight: 700; }

    /* =========================================
       5. Bottom Sheet (Three Column Grid)
       ========================================= */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: var(--z-overlay); backdrop-filter: blur(2px); }
    .bottom-sheet {
      position: fixed; bottom: 0; left: 50%; right: auto; 
      width: 100%; max-width: var(--app-max-width);
      transform: translate(-50%, 100%); 
      background: #fff; border-radius: 20px 20px 0 0; padding: 24px; 
      transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: var(--z-bottom); max-height: 85vh; overflow-y: auto; 
      box-shadow: 0 -4px 20px rgba(0,0,0,0.15); box-sizing: border-box;
    }
    .bottom-sheet.show { transform: translate(-50%, 0) !important; }

    .sheet-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .sheet-title { font-size: 1.4rem; font-weight: 800; color: #000; }
   
    /* 3-Column Grid: Label | Time | Buttons */
    .action-row { 
      display: grid; 
      /* Label | Time (Center) | Buttons (Right) */
      grid-template-columns: 130px 1fr auto; 
      align-items: center; 
      padding: 12px 0; 
      border-bottom: 1px dashed #eee; 
      gap: 4px;
    }
   
    .action-label { font-size: 1rem; font-weight: 700; color: var(--text-main); text-align: left; }
    .action-mid { text-align: center; } 
    .action-right { display: flex; justify-content: flex-end; } 

    /* Time & Status Colors */
    .action-time { font-family: monospace; font-size: 1rem; font-weight: 700; color: var(--c-brand); }
    .action-skip { font-size: 0.95rem; color: var(--c-brand); font-weight: 700; }

    .dynamic-sep { border-top: 4px solid #f1f5f9; margin: 16px -24px 16px -24px; }
    .dynamic-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 12px; color: var(--text-main); padding-top: 8px; }

    .btn-group { display: flex; gap: 8px; }
    .btn-solid { 
      padding: 8px 14px; border-radius: 6px; border: none; 
      font-size: 0.9rem; font-weight: 700; color: white; cursor: pointer; min-width: 64px; 
      transition: opacity 0.2s;
    }
    .btn-solid:active { opacity: 0.8; }
   
    .btn-do     { background: var(--c-brand); }
    .btn-skip   { background: var(--c-neutral); } /* Gray */
    .btn-mod    { background-color: var(--c-success); }
    .btn-del    { background-color: var(--c-danger); }
   
    .sheet-select { padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; font-weight: 500; width: 100%; }
   
    /* Location Management List Styles */
    .loc-list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f5f9; }
    .loc-list-txt { font-size: 1rem; font-weight: 700; color: var(--text-main); }
    .btn-remove-loc { 
      color: #fff; font-size: 0.85rem; font-weight: 700; cursor: pointer; 
      background: var(--c-danger); padding: 6px 12px; border-radius: 6px; border:none; 
    }

    /* Loading & Login */
    #loading { position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
    .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top-color: var(--c-brand); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    #loginView { display: flex; height: 100vh; flex-direction: column; align-items: center; justify-content: center; background: #fff; }
    .hidden { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>

<div id="loginView">
  <h2 style="color: var(--c-brand); margin-bottom: 24px;">2026 è»Šæµé€€å ´ä½œæ¥­</h2>
  <div id="g_id_onload"
       data-client_id="368914333961-tr57ogs6ig2cgfqqi5j5ml6h2ic67cd1.apps.googleusercontent.com" 
       data-callback="handleCredentialResponse"
       data-auto_select="true">
  </div>
  <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"></div>
</div>

<div id="appView" class="hidden">
  <header class="app-header">
    <div class="header-main">
        <div class="app-title">2026æ°´é™¸æ³•æœƒé€€å ´</div>
        <div class="header-clock" id="headerClock">--:--:--</div>
        <div class="header-right">
        <div class="refresh-ctrl" id="refreshCtrl"></div>
        <button class="btn-logout" onclick="logout()">ç™»å‡º</button>
        </div>
    </div>
   
    <div class="nav-tabs-wrapper">
        <button class="nav-tab active" onclick="switchTab('dash')">æ•´é«”æƒ…å ±</button>
        <button class="nav-tab" onclick="switchTab('op')">ç™»éŒ„èˆ‡ä¿®æ”¹</button>
    </div>

    <div class="nav-scroll-container" id="universalNav"></div>
  </header>

  <div class="container">
    <div id="tabDash" class="dash-section">
      <div id="dashContent"></div>
    </div>

    <div id="tabOp" class="hidden">
      <div class="op-action-row">
        <button id="btnAdd" class="btn-add hidden" onclick="promptAddColumn()">+ ç«™é»</button>
      </div>

      <div id="filterMsg" class="filter-bar hidden">
        <span id="filterText"></span>
        <span class="filter-clear" onclick="clearFilter()">é¡¯ç¤ºå…¨éƒ¨</span>
      </div>
      <div id="listContainer"></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay" onclick="closeSheet()"></div>
<div class="bottom-sheet" id="bottomSheet">
  <div class="sheet-head">
    <div class="sheet-title" id="sheetTitle">è»Šè¼›è³‡è¨Š</div>
    <div style="font-size:24px; color:#999; cursor:pointer;" onclick="closeSheet()">âœ•</div>
  </div>
  <div id="sheetBody"></div>
</div>

<div id="loading"><div class="spinner"></div></div>

<script>
  // ================= CONFIG =================
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwzLPpv2wBq9D2Ao4W4KrRoEX3LPvJgrpxa5IUBGG2YPSSB0fQ4Hnk2dbqOpXLUJjIq4A/exec'; 
  
  const SHEET_CONFIGS = [
    { 
      key:'åœ°å€å°ˆè»Šé€€å ´ï¼ˆéŠè¦½è»Šå¹³å°ï¼‰', color:'#059669',
      steps: ['è»Šé•·é€šçŸ¥è¡Œæåˆ°é½Š','Call è»Šä¸Šè¡Œæ','è»Šå·²ä¸ŠéŠè¦½è»Šå¹³å°','è»Šå‰å¾€æ’è»ŠéšŠ','è»Šæš«åœä½ç½®','é€€å ´äººå“¡å·²åˆ°é½Š','å·² Call è»Šä¸ŠéŠè¦½è»Šå¹³å°','äººå·²å‰å¾€å¹³å°æ­è»Š','è»Šç¬¬äºŒæ¬¡ä¸ŠéŠè¦½è»Šå¹³å°','è»Šå·²é›¢é–‹éŠè¦½è»Šå¹³å°'],
      parkingField: 'è»Šæš«åœä½ç½®'
    },
    { 
      key:'åœ°å€å°ˆè»Šé€€å ´ï¼ˆç¦ªå ‚å¹³å°ï¼‰', color:'#d97706',
      steps: ['è»Šé•·é€šçŸ¥è¡Œæåˆ°é½Š','Call è»Šä¸Šè¡Œæ','è»Šå·²ä¸ŠéŠè¦½è»Šå¹³å°','é›¢é–‹éŠè¦½è»Šå¹³å°','é€šééŠè¦½è»Šå¹³å°å‰å¾€æ’è»ŠéšŠ','è»Šåœé ä½ç½®','äººå·²å‰å¾€ç¦ªå ‚å¹³å°æ­è»Š','è»Šå·²é›¢é–‹ç¦ªå ‚å¹³å°'],
      parkingField: 'è»Šåœé ä½ç½®'
    },
    { 
      key:'æ°´é™¸å°ˆè»Šé€€å ´', color:'#7c3aed',
      steps: ['ç¢ºèªè»Šå·²æŠµé”åœ’å€','è»Šæš«åœä½ç½®','é€€å ´äººå“¡å·²åˆ°é½Š','å·² Call è»Šä¸ŠéŠè¦½è»Šå¹³å°','è»Šå·²ä¸ŠéŠè¦½è»Šå¹³å°','äººå¾è»Šåº«å‰å¾€å¹³å°æ­è»Š','è»Šå·²é›¢é–‹éŠè¦½è»Šå¹³å°'],
      parkingField: 'è»Šæš«åœä½ç½®'
    },
    { 
      key:'288æ³•é’é€€å ´', color:'#db2777',
      steps: ['é€€å ´äººå“¡å·²åˆ°é½Š','è»Šå·²ä¸ŠéŠè¦½è»Šå¹³å°','è»Šå·²é›¢é–‹éŠè¦½è»Šå¹³å°']
    }
  ];

  const STOP_OPTIONS = ['ğŸ…¿ï¸ ç¦ªå ‚å¹³å°','ğŸ…¿ï¸ æ³•å¿ƒåŒ—è·¯','ğŸ…¿ï¸ æ³•å¿ƒå—è·¯ï¼ˆè¥¿ï¼‰','ğŸ…¿ï¸ æ³•å¿ƒå—è·¯ï¼ˆæ±ï¼‰','ğŸ…¿ï¸ æ³•å¤§è·¯','ğŸ…¿ï¸ é›™ç’°è·¯è‡³æ³•å¤§ä¸€æ©‹'];
  const REFRESH_OPTIONS = [{ label:'5åˆ†', ms:300000 }, { label:'2åˆ†', ms:120000 }, { label:'60ç§’', ms:60000 }, { label:'30ç§’', ms:30000 }];

  let currentUser = null;
  let allData = {};
  let currentSheetName = SHEET_CONFIGS[0].key;
  let currentDashFilter = 'ALL';
  let activeFilter = null;
  let refreshTimer = null;
  let refreshMs = 60000;

  // ... (handleCredentialResponse, initApp, startClock, loadAllData, callApi, renderNavButtons, renderDashboard ä¿æŒä¸è®Š)

  function createSummaryTable(data, dynamicHeaders, cfg) {
    const rows = [];
    const carIdx = data.headers.findIndex(h => h.name === 'è»Šè™Ÿ');
    const areaIdx = data.headers.findIndex(h => h.name === 'å€åŸŸè»Šæ¬¡ç·¨è™Ÿ' || h.name.includes('å€åŸŸ'));

    data.rows.forEach(r => {
      dynamicHeaders.forEach(dh => {
        const colIdx = data.headers.indexOf(dh);
        const val = (r[colIdx] || '').trim();
        if(val && val !== 'Skip' && val !== '-') {
          rows.push({ car: r[carIdx], area: r[areaIdx], station: dh.name, time: val });
        }
      });
    });

    if(rows.length === 0) return null;

    const box = document.createElement('div');
    box.className = 'stat-card'; 
    box.style.padding = '12px';
   
    // å€åŸŸè»Šæ¬¡ç·¨è™Ÿåœ¨å‰ï¼Œè»Šè™Ÿåœ¨å¾Œï¼›æ‰‹æ©Ÿç‰ˆç¬¬ä¸€æ¬„ï¼šä¸Šæ–¹å€åŸŸï¼Œä¸‹æ–¹è»Šè™Ÿ
    let html = `<div class="dash-title" style="color:${cfg.color}; border-color:${cfg.color}; margin-top:0;">æ–°å¢ç«™é»ç´€éŒ„</div>
    <table class="summary-table">
      <tr>
        <th>å€åŸŸè»Šæ¬¡ç·¨è™Ÿ</th>
        <th class="col-desktop-car">è»Šè™Ÿ</th>
        <th>åœ°é»</th>
        <th>æ™‚é–“</th>
      </tr>`;
     
    rows.forEach(r => {
      html += `<tr>
          <td>
             <div class="mobile-area-tag">${r.area}</div>
             <div class="mobile-car-tag">${r.car}</div>
          </td>
          <td class="col-desktop-car">${r.car}</td>
          <td>${r.station}</td>
          <td>${r.time}</td>
      </tr>`;
    });
    html += '</table>';
    box.innerHTML = html;
    return box;
  }

  // ... (createStatCard, renderList ä¿æŒä¸è®Š)

  function openLocationSheet(locName, sheetKey) {
    const title = document.getElementById('sheetTitle');
    title.textContent = `${locName}`; 
    const body = document.getElementById('sheetBody');
    body.innerHTML = '';

    const data = allData[sheetKey];
    if(!data) return;
    
    const cfg = SHEET_CONFIGS.find(s => s.key === sheetKey);
    const parkingField = cfg.parkingField;
    const parkingIdx = data.headers.findIndex(h => h.name === parkingField);
    const carIdx = data.headers.findIndex(h => h.name === 'è»Šè™Ÿ');
    const areaIdx = data.headers.findIndex(h => h.name === 'å€åŸŸè»Šæ¬¡ç·¨è™Ÿ' || h.name.includes('å€åŸŸ'));

    // 1. Current Vehicles List
    const currentVehicles = data.rows.filter(r => (r[parkingIdx] || '').trim() === locName);
    
    body.innerHTML += `<div class="action-label" style="margin-bottom:8px;">ç¾æœ‰è»Šè¼› (${currentVehicles.length})</div>`;
    
    if(currentVehicles.length === 0) {
        body.innerHTML += `<div style="padding:10px; color:#999;">ç„¡è»Šè¼›</div>`;
    } else {
        currentVehicles.forEach(r => {
            const div = document.createElement('div');
            div.className = 'loc-list-item';
            // å€åŸŸè»Šæ¬¡ç·¨è™Ÿåœ¨å‰ï¼Œè»Šè™Ÿåœ¨å¾Œ
            div.innerHTML = `
                <div class="loc-list-txt">${r[areaIdx]} ${r[carIdx]}</div>
                <button class="btn-remove-loc" onclick="doAssignLoc('${sheetKey}', '${r[carIdx]}', '${parkingField}', '')">ç§»é™¤</button>
            `;
            body.appendChild(div);
        });
    }

    // 2. Add Vehicle Section
    const sep = document.createElement('div'); sep.className = 'dynamic-sep';
    const head = document.createElement('div'); head.className = 'dynamic-title'; head.textContent = 'åŠ å…¥è»Šè¼›';
    body.appendChild(sep);
    body.appendChild(head);

    const candidates = data.rows.filter(r => {
        const val = (r[parkingIdx] || '').trim();
        return !val || val === '-';
    });

    if(candidates.length > 0) {
        const sel = document.createElement('select');
        sel.id = 'selAddLocCar';
        sel.className = 'sheet-select';
        sel.style.marginBottom = '12px';
        // é¸é …ï¼šå€åŸŸè»Šæ¬¡ç·¨è™Ÿ è»Šè™Ÿ
        sel.innerHTML = `<option value="">è«‹é¸æ“‡è»Šè¼›</option>` + 
            candidates.map(r => `<option value="${r[carIdx]}">${r[areaIdx]} ${r[carIdx]}</option>`).join('');
        
        const btn = document.createElement('button');
        btn.className = 'btn-solid btn-do';
        btn.style.width = '100%';
        btn.textContent = 'ç¢ºå®šåŠ å…¥';
        btn.onclick = () => {
            const carNo = document.getElementById('selAddLocCar').value;
            if(!carNo) return alert('è«‹é¸æ“‡è»Šè¼›');
            doAssignLoc(sheetKey, carNo, parkingField, locName);
        };

        body.appendChild(sel);
        body.appendChild(btn);
    } else {
        body.innerHTML += `<div style="color:#999;">ç„¡å¯åŠ å…¥çš„è»Šè¼›</div>`;
    }

    document.getElementById('overlay').style.display = 'block';
    document.getElementById('bottomSheet').classList.add('show');
  }

  // ... (å…¶é¤˜å‡½æ•¸ï¼šdoAssignLoc, doAction, modifyTime, promptAddColumn, switchTab, goToFilter, clearFilter, closeSheet, renderRefreshCtrl, setRefresh, startTimer, logout ä¿æŒä¸è®Š)
</script>
</body>
</html>
